{% extends 'store/base.html' %}
{% load static %}
{% block title %} {% endblock %}
{% block content %}

    <div class="container mt-5 mb-5">
        <div class="d-flex justify-content-center row">
            <div class="col-md-10">
                {% for product in object_list %}
                    <div class="row p-2 bg-white border rounded">
                        <div class="col-md-3 mt-1"><img class="img-fluid img-responsive rounded product-image"
                                                        src="{{ product.image.url }}"></div>
                        <div class="col-md-6 mt-1">
                            <h5>{{ product.title }}</h5>
                            <div class="d-flex flex-row">
                                <span>#{{ product.category.name }}</span>
                            </div>
                            <div>{{ product.created_by }}</div>

                            <p class="text-justify para mb-0">{{ product.description|truncatewords:30 }}<br><br>
                            </p>
                        </div>
                        <div class="align-items-center align-content-center col-md-3 border-left mt-1">
                            <div class="d-flex flex-row align-items-center">
                                <h4 class="mr-1">${{ product.price }}</h4><span class="strike-text">$20.99</span>
                            </div>
                            <div class="col-6">
                                <label for="select">Qty</label>
                                <select id="select-qty">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                </select>

                            </div>
                            <div class="d-flex flex-column mt-4">
                                <a href="{% url 'store:product_detail' product.slug %}" class="btn btn-primary btn-sm"
                                   type="button">Details</a>
                                <button class="btn btn-outline-primary btn-sm mt-2" type="button"
                                        value="{{ product.id }}" id="add-to-card-button">Add to
                                    basket
                                </button>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        $(document).on('click', '#add-to-card-button', function (e) {
            e.preventDefault();
            $.ajax({
                type: 'POST',
                url: '{% url "basket:basket_add" %}',
                data: {
                    productid: $('#add-to-card-button').val(),
                    productqty: $('#select-qty option:selected').text(),
                    csrfmiddlewaretoken: "{{csrf_token}}",
                    action: 'post'
                },
                success: function (json) {
                    document.getElementById("basket-qty").innerHTML = json.qty
                },
                error: function (xhr, errmsg, err) {
                }
            });
        })
    </script>

{% endblock %}